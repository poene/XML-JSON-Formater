<!-- 
	author: poene
	date: 2018/4/12
	version: 1.0
	desc: off-line xml and json format tools
 -->

<!doctype html>
<html lang="en">
 <head>
  <meta charset="UTF-8">
  <meta name="Generator" content="EditPlus®">
  <meta name="Author" content="poene">
  <meta name="Keywords" content="XML JSON format">
  <link rel="shortcut icon" href="data:image/png;base64,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" type="image/x-icon"/>
  <meta name="Description" content="XML JSON format">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" />
  <title>XML JSON format</title>
 <style>
	body{
		margin-top: 0px;
	}
	::-webkit-scrollbar {display:none}
	.ui-head{
		text-align: center;
		position: relative;
		display: block;
		background-color: #EEE;
		line-height: 50px;
		margin: 0px 10px 10px 10px;
	}
	.xmlTab{
		display: inline-table;
		width: 50%;
		background-color: #8c8cd7;
		transition:background-color;
	}
	.jsonTab{
		display: block;
		width: 50%;
		float: right;
	}
	.ui-center{
		margin: 10px;
		position: relative;
		display: block;
	}
	.ui-input-div{
		height: 100%;
		display: inline-table;
		padding: 1px;
	}
	.input{
		width: calc(100% - 10px);
		height: 100%;
		padding: 5px;
		color: #aa4460;
		resize: none;
		font-family: PingFangSC-Regular;
	}
	.ui-output-div{
		height: 100%;
		padding: 1px;
	}
	.output{
	    width: calc(100% - 10px);
		height: 100%;
		padding: 5px;
		color: #aa4460;
		resize: none;
		font-family: PingFangSC-Regular;
	}
	@media only screen and (max-width: 480px) {
		.ui-input-div {
			width: 100%;
			height: 300px;
		}
		.ui-output-div {
			width: 100%;
			height: 300px;
		}
		.output{
			height: 300px;
		}
	}
	@media only screen and (min-width: 480px) {
		.ui-input-div {
			width: calc(50% - 10px);
			height: 480px;
		}
		.ui-output-div {
			width: calc(50% - 10px);
			height: 480px;
			float:right;
		}
		.output{
			height: 468px;
		}
	}
	.ui-foot{
		position: relative;
		display: inline-flex;
		background-color: #EEE;
		margin: 8px;
		border-radius: 5px;
		margin-top: 25px;
		width: 98.8%;
	}
	.formatbtn{
		border:1px solid #EEE;
		border-radius: 5px;
		color: #3549da;
		font-family: PingFangSC-Regular;
		padding: 8px;
		width: 60px;
		text-align: center;
		background-color:#AAA;
		display: inline-table;
	}
	.loginfo{
		width: calc(100% - 100px);
		padding: 8px;
		text-align: left;
		color: #ee1f1f;
		font-family: PingFangSC-Regular;
	}
 </style>
 </head>
 <script>
	window.op = "xml";
	document.getElementsByClassName("xmlTab")[0].addEventListener('touch',function(){
		xmlClick();
	},false);
	document.getElementsByClassName("jsonTab")[0].addEventListener('touch',function(){
		jsonClick();
	},false);
	document.getElementsByClassName("formatbtn")[0].addEventListener('touch',function(){
		formatOp();
	},false);
	function xmlClick() {
		window.op = "xml";
		document.getElementsByClassName("xmlTab")[0].style.background = "#8c8cd7";
		document.getElementsByClassName("jsonTab")[0].style.background = "#EEE";
		document.getElementsByClassName("loginfo")[0].innerHTML = "format xml";
		document.getElementsByClassName("output")[0].value = "";
	}
	function jsonClick() {
		window.op = "json";
		var xmlTab = document.getElementsByClassName("xmlTab")[0];
		xmlTab.style.background = "#EEE";
		var jsonTab = document.getElementsByClassName("jsonTab")[0];
		jsonTab.style.background = "#8c8cd7";
		document.getElementsByClassName("loginfo")[0].innerHTML = "format json";
		document.getElementsByClassName("output")[0].value = "";
	}
	function formatOp(){
		var input = document.getElementsByClassName("input")[0].value;
		var output = document.getElementsByClassName("output")[0].value;
		if(window.op == "xml"){
			// format xml
			try{
				var result = formatXml(input);  //new XML(input).toXMLString();
				document.getElementsByClassName("output")[0].value = result;
				document.getElementsByClassName("loginfo")[0].innerHTML = "format xml success！";
			}catch(e){
				document.getElementsByClassName("loginfo")[0].innerHTML = e;
				console.info(e);
			}
		}else{
			// format json
			try{
				var result = formatJson(input);  //JSON.stringify(input, null, 4);
				document.getElementsByClassName("output")[0].value = result.replace(/^\r\n/g,"");
				document.getElementsByClassName("loginfo")[0].innerHTML = "format json success！";
			}catch(e){
				document.getElementsByClassName("loginfo")[0].innerHTML = e;
				console.info(e);
			}
		}
	}
	function formatJson(json, options) {
         var reg = null,
                 formatted = '',
                 pad = 0,
                 PADDING = '    ';
         options = options || {};
         options.newlineAfterColonIfBeforeBraceOrBracket = (options.newlineAfterColonIfBeforeBraceOrBracket === true) ? true : false;
         options.spaceAfterColon = (options.spaceAfterColon === false) ? false : true;
         if (typeof json !== 'string') {
             json = JSON.stringify(json);
         } else {
             json = JSON.parse(json);
             json = JSON.stringify(json);
         }
         reg = /([\{\}])/g;
         json = json.replace(reg, '\r\n$1\r\n');
         reg = /([\[\]])/g;
         json = json.replace(reg, '\r\n$1\r\n');
         reg = /(\,)/g;
         json = json.replace(reg, '$1\r\n');
         reg = /(\r\n\r\n)/g;
         json = json.replace(reg, '\r\n');
         reg = /\r\n\,/g;
         json = json.replace(reg, ',');
         if (!options.newlineAfterColonIfBeforeBraceOrBracket) {
             reg = /\:\r\n\{/g;
             json = json.replace(reg, ':{');
             reg = /\:\r\n\[/g;
             json = json.replace(reg, ':[');
         }
         if (options.spaceAfterColon) {
             reg = /\:/g;
             json = json.replace(reg, ':');
         }
         (json.split('\r\n')).forEach(function (node, index) {
                     var i = 0,
                             indent = 0,
                             padding = '';
 
                     if (node.match(/\{$/) || node.match(/\[$/)) {
                         indent = 1;
                     } else if (node.match(/\}/) || node.match(/\]/)) {
                         if (pad !== 0) {
                             pad -= 1;
                         }
                     } else {
                         indent = 0;
                     }
                     for (i = 0; i < pad; i++) {
                         padding += PADDING;
                     }
                     formatted += padding + node + '\r\n';
                     pad += indent;
                 }
         );
         return formatted;
     };
     String.prototype.removeLineEnd = function () {
         return this.replace(/(<.+?\s+?)(?:\n\s*?(.+?=".*?"))/g, '$1 $2')
     }
	 function formatXml(text) {
         text = '\n' + text.replace(/(<\w+)(\s.*?>)/g, function ($0, name, props) {
                     return name + ' ' + props.replace(/\s+(\w+=)/g, " $1");
                 }).replace(/>\s*?</g, ">\n<");
         text = text.replace(/\n/g, '\r').replace(/<!--(.+?)-->/g, function ($0, text) {
             var ret = '<!--' + escape(text) + '-->';
             return ret;
         }).replace(/\r/g, '\n');
 
         var rgx = /\n(<(([^\?]).+?)(?:\s|\s*?>|\s*?(\/)>)(?:.*?(?:(?:(\/)>)|(?:<(\/)\2>)))?)/mg;
         var nodeStack = [];
         var output = text.replace(rgx, function ($0, all, name, isBegin, isCloseFull1, isCloseFull2, isFull1, isFull2) {
             var isClosed = (isCloseFull1 == '/') || (isCloseFull2 == '/' ) || (isFull1 == '/') || (isFull2 == '/');
             var prefix = '';
             if (isBegin == '!') {
                 prefix = getPrefix(nodeStack.length);
             } else {
                 if (isBegin != '/') {
                     prefix = getPrefix(nodeStack.length);
                     if (!isClosed) {
                         nodeStack.push(name);
                     }
                 } else {
                     nodeStack.pop();
                     prefix = getPrefix(nodeStack.length);
                 }
             }
             var ret = '\n' + prefix + all;
             return ret;
         });
 
         var prefixSpace = -1;
         var outputText = output.substring(1);
 
         outputText = outputText.replace(/\n/g, '\r').replace(/(\s*)<!--(.+?)-->/g, function ($0, prefix, text) {
             if (prefix.charAt(0) == '\r')
                 prefix = prefix.substring(1);
             text = unescape(text).replace(/\r/g, '\n');
             var ret = '\n' + prefix + '<!--' + text.replace(/^\s*/mg, prefix) + '-->';
             return ret;
         });
         return outputText.replace(/\s+$/g, '').replace(/\r/g, '\r\n');
     }
     function getPrefix(prefixIndex) {
         var span = '    ';
         var output = [];
         for (var i = 0; i < prefixIndex; ++i) {
             output.push(span);
         }
         return output.join('');
     }
 </script>
 <body>
	<div class="ui-head">
		<div class="xmlTab" onclick="return xmlClick();" ontouch="return xmlClick();">XML</div>
		<div class="jsonTab" onclick="return jsonClick();" ontouch="return jsonClick();">JSON</div>
	</div>
	<div class="ui-center">
		<div class="ui-input-div">
			<textarea name="" rows="" cols="" class="input" placeholder="input"></textarea>
		</div>
		<div class="ui-output-div">
			<textarea name="" rows="" cols="" class="output" placeholder="output"></textarea>
		</div>
	</div>
	<div class="ui-foot">
		<div class="formatbtn" onclick="return formatOp()" ontouch="return formatOp()">FORMAT</div>
		<div class="loginfo" >format xml</div>
	</div>
 </body>
</html>
